{% extends "base.html" %}
{% load static %}

{% block content %}
  <div class="container mt-4">
    <h2 class="my-4 text-center">All Tasks</h2>

    <div class="text-right mb-4">
      {% include "create_task.html" %}
    </div>

    <table class="table table-bordered">
      <thead class="thead-light">
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Deadline</th>
          <th>Responsible</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for task in task_list %}
          <tr>
            <td>{{ task.name }}</td>
            <td>{{ task.description }}</td>
            <td>{{ task.deadline|date:"Y-m-d" }}</td>
            <td>
              {% if task.assignees.all %}
                {% for worker in task.assignees.all %}
                  <span class="badge badge-info">{{ worker.username }}</span>
                {% endfor %}
              {% else %}
                <span class="badge badge-secondary">Not assigned</span>
              {% endif %}
            </td>
            <td>
              {% if task.is_completed %}
                <span class="badge badge-success">Done</span>
                <p class="mb-1"><strong>Completed At:</strong> {{ task.done_at|date:"Y-m-d H:i" }}</p>
              {% elif task.assignees.all %}
                <span class="badge badge-warning">In Progress</span>
              {% else %}
                <span class="badge badge-primary">New</span>
              {% endif %}
            </td>
            <td>
              <div>
                {% if request.user.is_superuser %}
                  <a href="{% url 'task_manager:task-update' task.id %}" class="btn btn-secondary btn-sm">Update</a>
                  <a href="{% url 'task_manager:task-delete' task.id %}" class="btn btn-danger btn-sm"
                     onclick="return confirm('Are you sure you want to delete this task?');">Delete</a>
                {% endif %}
                {% if task.assignees.count == 0 and not task.is_completed %}
                  <a href="{% url 'task_manager:manage-task' task.id 'take' %}" class="btn btn-success btn-sm">Take to Work</a>
                {% elif request.user in task.assignees.all and not task.is_completed %}
                  <a href="{% url 'task_manager:manage-task' task.id 'complete' %}" class="btn btn-success btn-sm">Complete Task</a>
                {% endif %}
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-center alert alert-info">No tasks available.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
